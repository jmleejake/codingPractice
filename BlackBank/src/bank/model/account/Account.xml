<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Account">
  <typeAlias alias="Account" type="bank.model.account.AccountBean"/>
  <resultMap id="AccountResult" class="Account">
    <result property="accNum" column="accNum"/>
    <result property="cltNum" column="cltNum"/>
    <result property="accPw" column="accPw"/> 
    <result property="crtDay" column="crtDay"/>
    <result property="expDay" column="expDay"/>
    <result property="payDay" column="payDay"/>
    <result property="balance" column="balance"/>
    <result property="prdCode" column="prdCode"/>
  </resultMap>
  
  <select id="getAllRetrieveAccs" resultMap="AccountResult">
    select * from account ORDER BY crtDay asc
  </select>  
  
  <select id="getRetrieveAcc" parameterClass="java.lang.String" resultClass="Account">
    select
      accNum as accNum,
      crtDay as crtDay,
      expDay as expDay,
      payDay as payDay,
      balance as balance          
    from account
    where accNum = #accNum#    
  </select>   
  
  <update id="setRegisterAcc" parameterClass="Account">
    insert into account (
      accNum, 
      cltNum,     
      accPw,
      crtDay,
      expDay,
      payDay,
      balance,
      prdCode
    )
    values (
     #accNum#, #cltNum#, #accPw#, SYSDATE, #expDay#, #payDay#, #balance#, #prdCode#
    )    
  </update>  
  
  <update id="setModifyAcc" parameterClass="Account">
    update account set
      balance= #balance#                 
    where
      accNum = #accNum#
  </update>
  
  <update id="setDTransAcc" parameterClass="Account">
    update account set
      balance= balance + #balance#           
    where
      accNum = #accNum#
  </update>
  
  <update id="setWTransAcc" parameterClass="Account">
    update account set
      balance= balance - #balance#              
    where
      accNum = #accNum#
  </update>
  
  <delete id="setRemoveAcc" parameterClass="Account">
    delete from account where accNum = #accNum# and accPw = #accPw#
  </delete>  
  
  <select id="getAccNumByCltNum" parameterClass="Account" resultClass="java.lang.String">
  	select 
  	  accNum as accNum
  	from account
  	where
  	  cltNum = #cltNum# and accNum = #accNum#
  </select>
  
  <select id="getRetrieveAccByCount" resultClass="java.lang.Integer">
    select count(*) from account  
  </select>
  
  <update id="setModifyAccOr">
    update account 
    set balance=balance*(1+ (select interest from product where prdCode = 'or') ) 
    where prdCode= 'or'
  </update>
  
  <update id="setModifyAccSa">
    update account 
    set balance=balance*(1+ (select interest from product where prdCode = 'sa') ) 
    where prdCode= 'sa'
  </update>
  
  <select id="searchAccNum" parameterClass="java.lang.String" resultClass="java.lang.String">
  	select accNum
  	from account
  	where accNum = #accNum#
  </select>
</sqlMap>