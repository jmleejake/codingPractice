<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="Board">

	<typeAlias alias="Board" type="exsoft.board.model.board.BoardDto"/>
	
	<update id="insertBoard" parameterClass="Board">
		insert into board (
			cno,
			ctitle,
			content,
			cday,
			mid,
			fileId,
			position,
			depth
		)
		values (
			#cno#, #ctitle#, #content#, (select TO_CHAR(sysdate, 'yyyy.mm.dd') from dual), #mid#, #fileId#, #position#, #depth#
		)
	</update>
	
	<select id="maxCno" resultClass="java.lang.Integer">
		select max(cno) from board
	</select>
	
	<select id="countCno" resultClass="java.lang.Integer">
		select count(cno) from board
	</select>
	
	<select id="selectAllBoard" resultClass="Board">
		select
			cno,
			ctitle,
			cday,
			mid,
			uday,
			position,
			depth
		from board
		order by position
	</select>
	
	<select id="selectBoardDetail" parameterClass="java.lang.Integer" resultClass="Board">
		select *
		from board
		where cno = #cno#
	</select>
	
	<select id="selectFileIdByCno" parameterClass="java.lang.Integer" resultClass="java.lang.String">
		select fileId
		from board
		where cno = #cno#
	</select>
	
	<select id="searchBoardByContent" parameterClass="java.lang.String" resultClass="Board">
		select *
		from board
		where content like '%$content$%'
		order by cno desc
	</select>
	
	<select id="searchBoardByCtitle" parameterClass="java.lang.String" resultClass="Board">
		select *
		from board
		where ctitle like '%$ctitle$%'
		order by cno desc
	</select>
	
	<select id="searchBoardByMname" parameterClass="java.lang.String" resultClass="Board">
		select *
		from board
		where mid = #mid#
		order by cno desc
	</select>
	
	<update id="updateBoard" parameterClass="Board">
		update board set
			ctitle = #ctitle#,
			content = #content#,
			fileId = #fileId#,
			uday = (select TO_CHAR(sysdate, 'yyyy.mm.dd') from dual)
		where cno = #cno#
	</update>
	
	<delete id="deleteBoard" parameterClass="java.lang.Integer">
		delete from board where cno = #cno#
	</delete>
	
	<select id="delCnoListByMid" parameterClass="java.lang.String" resultClass="Board">
		select cno from board where mid = #mid#
	</select>
	
	<select id="selectPositions" parameterClass="java.lang.Integer" resultClass="Board">
		select cno from board where position > #position#
	</select>
	
	<update id="updatePosition" parameterClass="java.lang.Integer">
		update board set
			position = position+1
		from board
			where cno = #cno#
	</update>
	
	<update id="insertReply" parameterClass="Board">
		insert into board (
			cno,
			ctitle,
			content,
			cday,
			mid,
			fileId,
			position,
			depth
		)
		values (
			#cno#, #ctitle#, #content#, (select TO_CHAR(sysdate, 'yyyy.mm.dd') from dual), #mid#, #fileId#, #position#, #depth#
		)
	</update>
	
</sqlMap>